<!DOCTYPE html><meta charset="UTF-8">
   . Calcule o investimento, economia, sistema ideal e impacto ambiental com base no seu gasto mensal.">
    <title>Simulador Solar Fotovoltaico Avançad rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">https://cdn.jsdelivr.net/npm/chart.js"></script>
   plugin-datalabels@2.0.0"></script> --> você!</p>
   ="form-step">
                <h2 Local</h2>
               -like-group">
                         <input type="radio" id="rede-sim" name="acesso_rede" value="sim" checked>
                         for="rede-sim"><i class="fas fa-check"_rede" value="nao">
                         <label for="rede-nao" JS se "Não" for selecionado (sistema off-grid é diferente) -->
                     </div>
                </div>
                <select id="estado" name="estado" required>
                           </option>
                           </select>
                        abilitar via JS após selecionar estado -->
                            <option value="">Selecione o estado primeiro..                        <span class="error-message" id="erro-cidade"<h2 checked>
                     <label for="tipo-residencial" class="icon-radio-label">
                                                 <span>Residencia</i>
                        >
                      <input type="radio" id="tipo-rural" name="tipo_imovel" value="rural">
                    "></i><span class="step-number"> class="slider-container">
                         <span class="slider-icon-left"><i class="fas fa-bolt"mensal" min="50" max="3000" value="500" step="10">
                         <span class="slider-icon-right"><i class="fas fa-bolt"                     </div>
                     id="erro-gasto"></span>
                kWh):</label>
                       0" step="0.01" value="0.85" required>
                         <span class="error-message" id="erro-tarifa"<label>Consumo Mensal Estimado
                     </div>
                Alterar Tarifa" se ela fosse pré-preenchida -->
            </section>

           
        </form>

       ">
                <!-- Coluna 1: Investimento -->
               -sign"></i>
                       <div class="resultado-card">
                       ">R$ --</span> aédia:</p>
                       <strong id="resultado-economia-total">R$ -<strong id="resultado-payback">-- ano-chart-area"></i> Ver Gráfico Paybac
                <div class="resultado-coluna">
                    o Ambiental Positivo</h3>
                   <strong id="resultado-co2">-- krvores Plantadas (em 25 anos):</p>
                       
                </div>

               -solar-panel"></i>
                        (Potência):</p>
                       >
                        <strong id="resultado-paineis">-acao-anual">-- kWh</strong>
                       >Peso Estimado sobre o Telhado:</p>
                        kg</strong>
                   <canvas id="graficoPaybackAcumulado"rem;"></canvas>
                fas fa-exclamation-triangle"></i>. Consulte um profissional para um projeto final.</p>
            Simulador Solar - Desenvolvido para fins educacionais.</p>
   , layout em colunas, estilo de botões de ícone, slider e cards de resultado.

ada na Neosolar */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

:root {
    --cor-primaria: #f39c12; /* Laranja/Amarelo Neosolar */
    --cor-secundaria: #34495e; /* Cinza/Azul Escuro Neosolar */
    --cor-fundo: #fdfcfb; /* Fundo levemente bege/branco */
    --cor-fundo-container: #ffffff;
    --cor-texto-principal: #333;
    --cor-texto-secundario: #555;
    --cor-texto-claro: #ffffff;
    --cor-borda: #e0e0e0;
    --cor-sucesso: #2ecc71;
    --cor-erro: #e74c3c;
    --cor-cinza-claro: #ecf0f1;
    --sombra-suave: 0 5px 15px rgba(0, 0, 0, 0.08);
    --borda-radius: 6px;
    --fonte-principal: 'Poppins', sans-serif;
}

/* Reset Básico */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: var(--fonte-principal);
    background-color: var(--cor-fundo);
    color: var(--cor-texto-principal);
    line-height: 1.7;
    font-size: 16px;
}

.container {
    max-width: 1100px;
    margin: 2rem auto;
    padding: 2rem;
    background-color: var(--cor-fundo-container);
    border-radius: var(--borda-radius);
    box-shadow: var(--sombra-suave);
}

header {
    background: linear-gradient(to right, var(--cor-secundaria), #4a6fa5); /* Gradiente sutil */
    color: var(--cor-texto-claro);
    padding: 2rem 0;
    text-align: center;
    border-bottom: 5px solid var(--cor-primaria);
    margin-bottom: 2.5rem;
}

header h1 {
    margin-bottom: 0.5rem;
    font-weight: 700;
}
header h1 i { margin-right: 0.8rem; color: var(--cor-primaria); }
header p { font-size: 1.1rem; opacity: 0.9; }

/* Estilo dos Passos do Formulário */
.form-step {
    margin-bottom: 2.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--cor-borda);
}
.form-step:last-of-type { border-bottom: none; }

.form-step h2 {
    font-size: 1.5rem;
    color: var(--cor-secundaria);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
}
.step-number {
    display: inline-block;
    background-color: var(--cor-primaria);
    color: var(--cor-texto-claro);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    line-height: 30px;
    text-align: center;
    font-size: 1rem;
    font-weight: 600;
    margin-right: 0.8rem;
}

/* Grupos de Input */
.input-group {
    margin-bottom: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    flex: 1; /* Para ocupar espaço em linhas */
}
.input-group label {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--cor-texto-secundario);
}
.input-group input[type="number"],
.input-group input[type="text"], /* Caso adicione */
.input-group select {
    padding: 0.8rem 1rem;
    border: 1px solid var(--cor-borda);
    border-radius: var(--borda-radius);
    font-size: 1rem;
    width: 100%;
    background-color: #fff;
    transition: border-color 0.3s ease;
}
.input-group input:focus,
.input-group select:focus {
    outline: none;
    border-color: var(--cor-primaria);
    box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.2);
}
.input-group select {
    appearance: none; /* Remove seta padrão */
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2334495e%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 0.65em auto;
    padding-right: 2.5rem; /* Espaço para a seta */
}
.input-group select:disabled {
    background-color: var(--cor-cinza-claro);
    cursor: not-allowed;
}

/* Input Groups em Linha */
.input-group-row {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start; /* Alinha labels no topo */
    margin-bottom: 1rem;
}
.location-group .input-group, .tariff-group .input-group {
    flex: 1; /* Faz com que ocupem espaço igual */
}

/* Radio Buttons Estilizados (Sim/Não) */
.radio-like-group input[type="radio"] { display: none; }
.radio-like-group label {
    display: inline-block;
    padding: 0.6rem 1.2rem;
    border: 1px solid var(--cor-borda);
    border-radius: var(--borda-radius);
    cursor: pointer;
    transition: all 0.3s ease;
    margin-right: 0.5rem;
}
.radio-like-group label i { margin-right: 0.4rem; }
.radio-like-group input[type="radio"]:checked + label {
    background-color: var(--cor-secundaria);
    color: var(--cor-texto-claro);
    border-color: var(--cor-secundaria);
}

/* Botões de Ícone (Tipo de Imóvel) */
.icon-radio-group {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
}
.icon-radio-group input[type="radio"] { display: none; }
.icon-radio-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    border: 1px solid var(--cor-borda);
    border-radius: var(--borda-radius);
    cursor: pointer;
    min-width: 100px;
    text-align: center;
    transition: all 0.3s ease;
}
.icon-radio-label i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: var(--cor-secundaria);
    transition: color 0.3s ease;
}
.icon-radio-label span {
    font-size: 0.9rem;
    font-weight: 600;
}
.icon-radio-group input[type="radio"]:checked + .icon-radio-label {
    border-color: var(--cor-primaria);
    background-color: rgba(243, 156, 18, 0.1);
    box-shadow: 0 0 0 2px rgba(243, 156, 18, 0.3);
}
.icon-radio-group input[type="radio"]:checked + .icon-radio-label i {
    color: var(--cor-primaria);
}

/* Slider de Gasto Mensal */
.slider-group label { margin-bottom: 0.8rem; display: block; }
.slider-container {
    display: flex;
    align-items: center;
    gap: 1rem;
    width: 100%;
}
.slider-container input[type="range"] {
    flex-grow: 1;
    appearance: none;
    width: 100%;
    height: 8px;
    background: var(--cor-cinza-claro);
    border-radius: 5px;
    outline: none;
    cursor: pointer;
}
/* Estilo do "polegar" do slider (Chrome, Edge, Safari) */
.slider-container input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    background: var(--cor-primaria);
    border-radius: 50%;
    cursor: pointer;
    transition: background-color 0.2s ease;
}
.slider-container input[type="range"]::-webkit-slider-thumb:hover {
    background: #e67e22; /* Laranja mais escuro */
}
/* Estilo do "polegar" do slider (Firefox) */
.slider-container input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: var(--cor-primaria);
    border-radius: 50%;
    cursor: pointer;
    border: none;
    transition: background-color 0.2s ease;
}
.slider-container input[type="range"]::-moz-range-thumb:hover {
    background: #e67e22;
}
.slider-icon-left i, .slider-icon-right i {
    color: var(--cor-secundaria);
    font-size: 1.2rem;
}
#gasto-mensal-valor {
    display: block;
    text-align: center;
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--cor-secundaria);
    margin-top: 0.5rem;
    background-color: var(--cor-cinza-claro);
    padding: 0.5rem;
    border-radius: var(--borda-radius);
}

/* Valor Derivado (Consumo Estimado) */
.derived-value label { color: var(--cor-texto-secundario); }
.display-value {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--cor-secundaria);
    padding: 0.8rem 1rem;
    background-color: var(--cor-cinza-claro);
    border-radius: var(--borda-radius);
    display: inline-block;
    min-width: 100px; /* Ajuste conforme necessário */
    text-align: center;
}

/* Mensagem de Erro */
.error-message {
    color: var(--cor-erro);
    font-size: 0.85rem;
    display: none; /* Oculto por padrão */
    margin-top: 0.2rem;
}

/* Botão Principal */
button#botao-calcular {
    background-color: var(--cor-primaria);
    color: var(--cor-texto-claro);
    border: none;
    padding: 1rem 2rem;
    font-size: 1.2rem;
    font-weight: 600;
    border-radius: var(--borda-radius);
    cursor: pointer;
    transition: all 0.3s ease;
    display: block;
    width: fit-content;
    margin: 2rem auto 0 auto; /* Centraliza */
}
button#botao-calcular:hover {
    background-color: #e67e22;
    transform: translateY(-3px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}
button#botao-calcular i { margin-right: 0.7rem; }

/* --- Seção de Resultados --- */
#resultado-calculo {
    margin-top: 3rem;
    padding: 2rem;
    background-color: var(--cor-cinza-claro); /* Fundo da seção */
    border-radius: var(--borda-radius);
}
#resultado-calculo h2 {
    text-align: center;
    color: var(--cor-secundaria);
    margin-bottom: 2rem;
    font-size: 1.8rem;
}
#resultado-calculo h2 i { margin-right: 1rem; color: var(--cor-primaria); }

.resultados-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* 3 colunas responsivas */
    gap: 2rem;
}

.resultado-coluna .resultado-header {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--cor-primaria);
}
.resultado-coluna .resultado-header i {
    font-size: 1.8rem;
    color: var(--cor-primaria);
    margin-right: 0.8rem;
    width: 30px; /* Largura fixa para alinhar texto */
    text-align: center;
}
.resultado-coluna .resultado-header h3 {
    font-size: 1.3rem;
    color: var(--cor-secundaria);
    font-weight: 600;
}

.resultado-card {
    background-color: var(--cor-fundo-container);
    padding: 1.5rem;
    border-radius: var(--borda-radius);
    box-shadow: var(--sombra-suave);
    height: 100%; /* Para alinhar cards na mesma linha */
}
.resultado-card p {
    font-size: 0.9rem;
    color: var(--cor-texto-secundario);
    margin-bottom: 0.3rem;
}
.resultado-card strong {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--cor-secundaria);
    display: block;
    margin-bottom: 1rem;
}
.resultado-card strong:last-of-type { margin-bottom: 0; } /* Remove margem do último strong */

/* Botão Secundário (Ver Gráfico) */
.botao-secundario {
    background-color: var(--cor-secundaria);
    color: var(--cor-texto-claro);
    border: none;
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
    font-weight: 600;
    border-radius: var(--borda-radius);
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 1rem;
    display: inline-block;
}
.botao-secundario:hover {
    background-color: #506b84; /* Tom mais claro do secundário */
    transform: translateY(-2px);
}
.botao-secundario i { margin-right: 0.5rem; }

/* Gráficos */
#graficos-resultado-container h3 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: var(--cor-secundaria);
    font-size: 1.3rem;
}
canvas {
    max-width: 100%;
    height: auto;
    margin: 0 auto;
    display: block;
}

/* Disclaimer */
.disclaimer {
    margin-top: 2.5rem;
    padding: 1rem 1.5rem;
    background-color: #fff9e6; /* Amarelo bem claro */
    border: 1px solid #ffeccc;
    border-left: 5px solid var(--cor-primaria);
    border-radius: var(--borda-radius);
    color: #8c6d31;
    font-size: 0.9rem;
}
.disclaimer i { margin-right: 0.7rem; color: var(--cor-primaria); }

/* Classe Utilitária */
.hidden { display: none !important; } /* Garante que sobreponha outros displays */

/* Footer */
footer {
    text-align: center;
    margin-top: 3rem;
    padding: 1.5rem;
    font-size: 0.9rem;
    color: #888;
    border-top: 1px solid var(--cor-borda);
}

/* Responsividade */
@media (max-width: 992px) {
    .container { padding: 1.5rem; }
    .resultados-container { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
    .resultado-card strong { font-size: 1.3rem; }
}

@media (max-width: 768px) {
    body { font-size: 15px; }
    .container { margin: 1rem; padding: 1rem; }
    header h1 { font-size: 1.8rem; }
    header p { font-size: 1rem; }
    .form-step h2 { font-size: 1.3rem; }
    .step-number { width: 25px; height: 25px; line-height: 25px; font-size: 0.9rem; }
    .input-group-row { flex-direction: column; gap: 1rem; }
    .icon-radio-group { justify-content: center; }
    .resultados-container { grid-template-columns: 1fr; gap: 1.5rem; } /* Uma coluna */
    .resultado-coluna .resultado-header { justify-content: center; }
    .resultado-card { text-align: center; }
    button#botao-calcular { width: 100%; padding: 0.9rem 1.5rem; font-size: 1.1rem; }
}

@media (max-width: 480px) {
    header { padding: 1.5rem 0; }
    header h1 { font-size: 1.5rem; }
    .icon-radio-label { min-width: 80px; padding: 0.8rem; }
    .icon-radio-label i { font-size: 1.5rem; }
    .icon-radio-label span { font-size: 0.8rem; }
    #gasto-mensal-valor { font-size: 1.1rem; }
    .resultado-card strong { font-size: 1.2rem; }
}
 agora inclui:
*   Dados de exemplo para cidades/HSP (precisa ser expandido).
*   Lógica para popular o select de cidades baseado no estado.
*   Listener para o slider de gasto mensal para atualizar o valor exibido e o consumo estimado.
*   Cálculo do consumo estimado a partir do gasto e tarifa.
*   Novos cálculos (peso, CO2->árvores/km, economia 25 anos).
*   Atualização de todos os novos campos de resultado.
*   Função básica para mostrar/esconder gráficos de resultado.
*   Gráfico de Payback Acumulado (exemplo).

.js - Versão Avançada

document.addEventListener('DOMContentLoaded', () => {

    // --- Seleção de Elementos do DOM ---
    const form = document.getElementById('calculadora-form');
    const selectEstado = document.getElementById('estado');
    const selectCidade = document.getElementById('cidade');
    const inputGastoMensal = document.getElementById('gasto-mensal');
    const outputGastoMensalValor = document.getElementById('gasto-mensal-valor');
    const inputTarifa = document.getElementById('tarifa');
    const spanConsumoEstimado = document.getElementById('consumo-estimado');
    const secaoResultado = document.getElementById('resultado-calculo');
    const botaoVerGraficoInvestimento = document.getElementById('ver-grafico-investimento');
    const graficosResultadoContainer = document.getElementById('graficos-resultado-container');

    // Elementos para exibir os resultados
    const resultadoInvestimento = document.getElementById('resultado-investimento');
    const resultadoEconomiaMes = document.getElementById('resultado-economia-mes');
    const resultadoEconomiaTotal = document.getElementById('resultado-economia-total');
    const resultadoPayback = document.getElementById('resultado-payback');
    const resultadoCo2 = document.getElementById('resultado-co2');
    const resultadoArvores = document.getElementById('resultado-arvores');
    const resultadoKmCarro = document.getElementById('resultado-km-carro');
    const resultadoPotencia = document.getElementById('resultado-potencia');
    const resultadoPaineis = document.getElementById('resultado-paineis');
    const resultadoGeracaoAnual = document.getElementById('resultado-geracao-anual');
    const resultadoArea = document.getElementById('resultado-area');
    const resultadoPeso = document.getElementById('resultado-peso');

    // Spans para mensagens de erro (adicionar mais se necessário)
    const erroEstado = document.getElementById('erro-estado');
    const erroCidade = document.getElementById('erro-cidade');
    const erroGasto = document.getElementById('erro-gasto');
    const erroTarifa = document.getElementById('erro-tarifa');

    // Contextos dos Gráficos
    const ctxPayback = document.getElementById('graficoPaybackAcumulado')?.getContext('2d'); // Usar ? para segurança
    const ctxConsumoGeracao = document.getElementById('graficoConsumoGeracao')?.getContext('2d');
    let graficoPayback;
    let graficoConsumoGeracao;

    // --- Dados e Constantes ---
    const dadosCidades = {
        'RJ': [
            { nome: 'Rio de Janeiro', hsp: 4.55 },
            { nome: 'Niterói', hsp: 4.60 },
            { nome: 'Duque de Caxias', hsp: 4.50 }
        ],
        'SP': [
            { nome: 'São Paulo', hsp: 4.70 }, // Ajustar HSPs reais
            { nome: 'Campinas', hsp: 4.85 },
            { nome: 'Guarulhos', hsp: 4.65 }
        ],
        'MG': [
            { nome: 'Belo Horizonte', hsp: 5.10 },
            { nome: 'Uberlândia', hsp: 5.30 },
            { nome: 'Contagem', hsp: 5.05 }
        ],
         'BA': [
            { nome: 'Salvador', hsp: 5.40 },
            { nome: 'Feira de Santana', hsp: 5.35 }
        ],
         'CE': [
            { nome: 'Fortaleza', hsp: 5.90 },
            { nome: 'Caucaia', hsp: 5.85 }
        ]
        // Adicionar mais estados e cidades com seus HSPs médios
    };

    const POTENCIA_PAINEL_W = 550;
    const FATOR_PERDAS = 0.20; // 20% de perdas totais
    const AREA_POR_PAINEL_M2 = 2.5;
    const PESO_POR_PAINEL_KG = 25; // Peso médio de um painel + estrutura básica
    const CUSTO_MEDIO_POR_Wp_INSTALADO = 3.50; // R$/Wp - AJUSTAR CONFORME MERCADO
    const FATOR_CO2_EVITADO_POR_KWH = 0.075; // kg CO²/kWh (média Brasil)
    const FATOR_ARVORES_POR_TON_CO2 = 7; // Nº árvores equivalentes a 1 ton CO² sequestrada
    const FATOR_KM_CARRO_ELETRICO_POR_KWH = 5; // km rodados por kWh (exemplo)
    const VIDA_UTIL_SISTEMA_ANOS = 25;
    const DIAS_NO_ANO = 365;
    const MESES_NO_ANO = 12;

    // --- Funções Auxiliares ---
    const mostrarErro = (elementoErro, mensagem) => {
        if (elementoErro) {
            elementoErro.textContent = mensagem;
            elementoErro.style.display = 'block';
        }
    };
    const limparErro = (elementoErro) => {
        if (elementoErro) {
            elementoErro.textContent = '';
            elementoErro.style.display = 'none';
        }
    };
    const limparTodosErros = () => {
        limparErro(erroEstado);
        limparErro(erroCidade);
        limparErro(erroGasto);
        limparErro(erroTarifa);
        // Limpar outros erros se adicionados
    };

    const formatarMoeda = (valor) => valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    const formatarNumero = (valor, casasDecimais = 0) => valor.toLocaleString('pt-BR', { minimumFractionDigits: casasDecimais, maximumFractionDigits: casasDecimais });

    // Popula o select de cidades baseado no estado selecionado
    const popularCidades = () => {
        const estadoSelecionado = selectEstado.value;
        selectCidade.innerHTML = '<option value="">Selecione...</option>'; // Limpa opções antigas
        selectCidade.disabled = true;

        if (estadoSelecionado && dadosCidades[estadoSelecionado]) {
            dadosCidades[estadoSelecionado].forEach(cidade => {
                const option = document.createElement('option');
                option.value = cidade.hsp; // Valor da opção é o HSP
                option.textContent = `${cidade.nome} (HSP: ${cidade.hsp.toFixed(2)}});
            selectCidade.disabled = false;
        } else if (estadoSelecionado) {
             selectCidade.innerHTML = '<option value="">Nenhuma cidade cadastrad '<option value="">Selecione o estado primeiro..        const tarifa = parseFloat(inputTarifa.value);

        outputGastoMensalValor.textContent = formatarMoeda(gasto);

        if (!isNaN(gasto) && !isNaN(tarifa) && tarifa > 0) {
            const consumo = gasto / tarifa;
            spanConsumoEstimado.textContent = `${formatarNumero(consumo)} kW = '-- kWh';
        }
    };

    // --- Validação ---
    const validarEntradas = () => {
        limparTodosErros();
        let ehValido = true;

        if (!selectEstado.value) {
            mostrarErro(erroEstado, 'Selecione o estado.');
            ehValido = false;
        }
        if (!selectCidade.value) {
            mostrarErro(erroCidade, 'Selecione a cidade.');
            ehValido = false;
        }
        const gasto = parseFloat(inputGastoMensal.value);
        if (isNaN(gasto) || gasto <= 0) {
            mostrarErro(erroGasto, 'Informe um valor de gasto mensal válido.');
            ehValido = false;
        }
        const tarifa = parseFloat(inputTarifa.value);
        if (isNaN(tarifa) || tarifa <= 0) {
            mostrarErro(erroTarifa, 'Informe uma tarifa válida (R$/kWh).');
            ehValido = false;
        }

        // Adicionar validação para tipo de imóvel e acesso à rede se necessário

        return ehValido;
    };

    // --- Cálculos Principais ---
    const calcularSimulacao = (gastoMensal, tarifa, hsp) => {
        const consumoMensalEstimado = gastoMensal / tarifa;
        if (consumoMensalEstimado <= 0) return null; // Evita divisão por zero ou valores inválidos

        const energiaDiariaNecessaria = consumoMensalEstimado / (DIAS_NO_ANO / MESES_NO_ANO);
        const energiaDiariaCorrigida = energiaDiariaNecessaria / (1 - FATOR_PERDAS);
        const potenciaSistemaKWp = energiaDiariaCorrigida / hsp;
        const numeroPaineis = Math.ceil((potenciaSistemaKWp * 1000) / POTENCIA_PAINEL_W);
        const areaMinima = numeroPaineis * AREA_POR_PAINEL_M2;
        const pesoEstimado = numeroPaineis * PESO_POR_PAINEL_KG;

        // Geração Anual Estimada
        const geracaoAnualEstimada = potenciaSistemaKWp * hsp * DIAS_NO_ANO * (1 - FATOR_PERDAS);
        const geracaoMensalEstimada = geracaoAnualEstimada / MESES_NO_ANO;

        // Economia (Simplificado: Assume que a geração cobre o consumo até o limite do consumo)
        const economiaMensal = Math.min(geracaoMensalEstimada, consumoMensalEstimado) * tarifa;
        const economiaAnual = economiaMensal * MESES_NO_ANO;
        const economiaTotalVidaUtil = economiaAnual * VIDA_UTIL_SISTEMA_ANOS; // Simplificado, sem inflação energética

        // Investimento
        const investimentoEstimado = potenciaSistemaKWp * 1000 * CUSTO_MEDIO_POR_Wp_INSTALADO;

        // Payback Simples
        const paybackAnos = investimentoEstimado > 0 && economiaAnual > 0 ? investimentoEstimado / economiaAnual : 0;

        // Ambiental
        const co2EvitadoAnual = geracaoAnualEstimada * FATOR_CO2_EVITADO_POR_KWH;
        const co2EvitadoTotal = co2EvitadoAnual * VIDA_UTIL_SISTEMA_ANOS;
        const arvoresEquivalentes = (co2EvitadoTotal / 1000) * FATOR_ARVORES_POR_TON_CO2; // CO2 em toneladas
        const kmCarroEletricoAnual = geracaoAnualEstimada * FATOR_KM_CARRO_ELETRICO_POR_KWH;

        return {
            potenciaSistemaKWp,
            numeroPaineis,
            areaMinima,
            pesoEstimado,
            geracaoAnualEstimada,
            economiaMensal,
            economiaTotalVidaUtil,
            investimentoEstimado,
            paybackAnos,
            co2EvitadoAnual,
            arvoresEquivalentes,
            kmCarroEletricoAnual,
            consumoMensalEstimado // Retorna para usar nos gráficos
        };
    };

    // --- Exibição dos Resultados ---
    const exibirResultados = (resultados) => {
        if (!resultados) return; // Não exibe se o cálculo falhou

        resultadoInvestimento.textContent = formatarMoeda(resultados.investimentoEstimado);
        resultadoEconomiaMes.textContent = formatarMoeda(resultados.economiaMensal);
        resultadoEconomiaTotal.textContent = formatarMoeda(resultados.economiaTotalVidaUtil);
        resultadoPayback.textContent = resultados.paybackAnos > 0 ? `${formatarNumero(resultados.paybackAnos, 1)} ano2.textContent = `${formatarNumero(resultados.co2EvitadoAnual)} kivalentes)} árvores`;
        resultadoKmCarro.textContent =`;

        resultadoPotencia.textContent =arNumero(resultados.numeroPaineis);
        resultadoGeracaoAnual.textContent = `${formatarNumero(resultados.geracaoAnualEstimada)} kWformatarNumero(resultados.pesoEstimado)} kg`;

        // Atualiza gráficos (passando dados necessários)
        atualizarGraficoConsumoGeracao(resultados.consumoMensalEstimado, resultados.geracaoAnualEstimada / MESES_NO_ANO);
        atualizarGraficoPayback(resultados.investimentoEstimado, resultados.economiaAnual, resultados.paybackAnos);

        // Mostra a seção de resultados e esconde/mostra gráficos inicialmente
        secaoResultado.classList.remove('hidden');
        graficosResultadoContainer.classList.add('hidden'); // Começa com gráficos escondidos

        // Rola para os resultados
        secaoResultado.scrollIntoView({ behavior: 'smooth', block: 'start' });
    };

    // --- Funções dos Gráficos ---

    // Gráfico de Pizza: Consumo vs Geração Mensal
    const atualizarGraficoConsumoGeracao = (consumo, geracao) => {
        if (!ctxConsumoGeracao) return;
        const data = {
            labels: ['Consumo Médio (kWh)', 'Geração Estimada (kWh)'],
            datasets: [{
                data: [consumo.toFixed(0), geracao.toFixed(0)],
                backgroundColor: ['rgba(231, 76, 60, 0.7)', 'rgba(46, 204, 113, 0.7)'],
                borderColor: ['#e74c3c', '#2ecc71'],
                borderWidth: 1
            }]
        };
        const config = { type: 'doughnut', data: data, options: { responsive: true, plugins: { legend: { position: 'top' } } } };
        if (graficoConsumoGeracao) graficoConsumoGeracao.destroy();
        graficoConsumoGeracao = new Chart(ctxConsumoGeracao, config);
    };

    // Gráfico de Linha/Barra: Payback Acumulado
    const atualizarGraficoPayback = (investimento, economiaAnual, paybackAnos) => {
        if (!ctxPayback || investimento <= 0 || economiaAnual anosParaGrafico = Math.max(Math.ceil(paybackAnos) + 3, 10); // Mostra alguns anos após payback ou 10 anos
        const labelsAnos = Array.from({ length: anosParaGrafico + 1 }, (_, i) => `Ano ${iInvestimento = Array(anosParaGrafico + 1).fill(investimento); // Linha de custo
        const dadosEconomiaAcumulada = labelsAnos.map((_, i) => Math.min(economiaAnual * i, investimento * 1.5)); // Economia acumulada (limita visualmente)
        const dadosSaldo = labelsAnos.map((_, i) => (economiaAnual * i) - investimento); // Saldo (negativo até payback)

        const data = {
            labels: labelsAnos,
            datasets: [
                {
                    label: 'Investimento (R$)',
                    data: dadosInvestimento,
                    borderColor: 'rgba(231, 76, 60, 0.8)', // Vermelho
                    borderDash: [5, 5], // Linha tracejada
                    type: 'line',
                    fill: false,
                    pointRadius: 0,
                },
                {
                    label: 'Economia Acumulada (R$)',
                    data: dadosEconomiaAcumulada,
                    borderColor: 'rgba(46, 204, 113, 0.8)', // Verde
                    backgroundColor: 'rgba(46, 204, 113, 0.2)',
                    type: 'line',
                    fill: true,
                    tension: 0.1
                },
                 {
                    label: 'Saldo (R$)',
                    data: dadosSaldo,
                    borderColor: 'rgba(54, 162, 235, 0.8)', // Azul
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    type: 'bar', // Pode ser barra ou linha
                }
            ]
        };
        const config = {
            type: 'line', // Tipo base, mas datasets podem ter tipos diferentes
            data: data,
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Payback e Economia Acumulada ao Longo dos Anos' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    y: {
                        beginAtZero: false, // Permite ver o investimento negativo
                        ticks: { callback: value => formatarMoeda(value) }
                    }
                }
            }
        };
        if (graficoPayback) graficoPayback.destroy();
        graficoPayback = new Chart(ctxPayback, config);
    };


    // --- Event Listeners ---
    selectEstado.addEventListener('change', popularCidades);

    inputGastoMensal.addEventListener('input', atualizarDisplayGasto);
    inputTarifa.addEventListener('input', atualizarDisplayGasto); // Atualiza consumo se tarifa mudar

    form.addEventListener('submit', (event) => {
        event.preventDefault();
        if (validarEntradas()) {
            const gasto = parseFloat(inputGastoMensal.value);
            const tarifa = parseFloat(inputTarifa.value);
            const hsp = parseFloat(selectCidade.value);

            const resultados = calcularSimulacao(gasto, tarifa, hsp);
            exibirResultados(resultados);
        } else {
            secaoResultado.classList.add('hidden'); // Esconde resultados se validação falhar
        }
    });

    botaoVerGraficoInvestimento?.addEventListener('click', () => {
        graficosResultadoContainer.classList.toggle('hidden');
        // Rola para os gráficos se eles forem exibidos
        if (!graficosResultadoContainer.classList.contains('hidden')) {
            graficosResultadoContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });

    // --- Inicialização ---
    popularCidades(); // Tenta popular cidades caso um estado já esteja selecionado (ex: cache do navegador)
    atualizarDisplayGasto(); // Atualiza display inicial do slider/consumo

}); // Fim do DOMContentLoaded
 o conteúdo dos seus arquivos `index.htm
3.  **Ajuste as Constantes:** Verifique e ajuste os valores das constantes no `script.jp, fatores ambientais, etc.) para refletir a realidade que você quer simular.
4.  **Expanda os Dados:** Adicione mais estados e cidades com seus respectivos HSPs médios em `dadosCidade aparência. Ajuste o CSS e o JS conforme necessário para chegar mais perto do visual desejado ou corrigir comportamentos.

Esta versão é um salto significativo em direção ao layout e funcionalidade da Neosolar, introduzindo o input por gasto mensal, cálculos mais detalhados e uma estrutura visual mais organizada.
